let a=null,n=null;async function s(){return a!==null?a:(n!==null||(n=(async()=>{try{console.log("[PriceAPILocal] Loading price cache from file...");const e=await fetch("/poke-scanner/prices.json");if(!e.ok)return console.error("[PriceAPILocal] Failed to load price cache:",e.status),{};const c=await e.json();return console.log(`[PriceAPILocal] Price cache loaded successfully with ${Object.keys(c).length} entries`),a=c,a}catch(e){return console.error("[PriceAPILocal] Error loading price cache:",e),a={},a}finally{n=null}})()),n)}function l(e,c){const r=c.match(/^(\d+)([a-zA-Z]*)$/);if(r){const o=r[1].padStart(3,"0"),t=r[2];return`${e}${o}${t}`.toUpperCase()}return`${e}${c}`.toUpperCase()}async function i(e,c){console.log(`[PriceAPILocal] Fetching price for ${e}/${c}`);const r=await s(),o=l(e,c);return r[o]?(console.log(`[PriceAPILocal] Found price for ${e}/${c}:`,r[o]),{series:r[o].series,number:r[o].number,cardName:r[o].cardName,avgPrice:r[o].avgPrice,url:r[o].url}):(console.log(`[PriceAPILocal] No price found for ${e}/${c}`),null)}async function u(e){console.log(`[PriceAPILocal] Fetching batch prices for ${e.length} cards`);const c=await s(),r=[];for(const o of e){const t=l(o.series,o.number);c[t]?r.push({series:c[t].series,number:c[t].number,cardName:c[t].cardName,avgPrice:c[t].avgPrice,url:c[t].url}):console.log(`[PriceAPILocal] No price found for ${o.series}/${o.number}`)}return console.log(`[PriceAPILocal] Batch fetch complete: ${r.length}/${e.length} prices found`),r}async function h(){try{const e=await s();return Object.keys(e).length>0}catch(e){return console.error("[PriceAPILocal] Health check failed:",e),!1}}async function f(){const e=await s(),c=Object.keys(e),r=new Set;return c.forEach(o=>{e[o].series&&r.add(e[o].series)}),{totalEntries:c.length,totalSeries:r.size,series:Array.from(r).sort()}}export{h as checkApiHealth,u as fetchBatchPrices,i as fetchCardPrice,f as getCacheStats};
